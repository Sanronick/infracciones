<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.plot.ly/plotly-3.0.1.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="{{url_for('static',filename='css/styles.css')}}">
    <title>Dashboard 1</title>
</head>
<body>
    <h2>Infracciones por Año</h2>
    <form action="/infracciones" method="post" id="form1">
        <label for="fecha1">Seleccione una Fecha: </label>
        <input type="date" name="fecha1" id="fecha1" required>
        <label for="fecha2">Hasta: </label>
        <input type="date" name="fecha2" id="fecha2" required>
        <button type="submit" name="action" value="ver">VER</button>
    </form>
    <div id="spinner-overlay" style="display: none;">
        <div class="loader"></div>
    </div>
    <div id="grafico1"></div>
    <div id="error-message" class="error-message"></div>

    <script>
        document.getElementById('form1').addEventListener('submit', function(event) {
            event.preventDefault();

            const fecha1 = document.getElementById('fecha1').value;
            const fecha2 = document.getElementById('fecha2').value;
            const errorMessage = document.getElementById('error-message');
            errorMessage.style.display = 'none';

            // Muestro el spinner
            document.getElementById('spinner-overlay').style.display = 'flex';

            fetch('/infracciones', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ fecha1, fecha2 })
            })
            .then(response => response.json())
            .then(data => {
                // Oculto el spinner
                document.getElementById('spinner-overlay').style.display = 'none';
                if (data && data.grafico1) {
                    const grafico1 = JSON.parse(data.grafico1);
                    Plotly.newPlot('grafico1', grafico1.data, grafico1.layout, { responsive: true });
                } else {
                    errorMessage.textContent = 'Error: No se recibieron datos del gráfico.';
                    errorMessage.style.display = 'block';
                }
            })
            .catch(error => {
                // Oculto el spinner en caso de error
                document.getElementById('spinner-overlay').style.display = 'none';
                errorMessage.textContent = `Error al cargar el gráfico: ${error}`;
                errorMessage.style.display = 'block';
            });
        });
    </script>
</body>
</html>